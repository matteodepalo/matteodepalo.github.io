
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Cube loves Geckoboard - Matteo Depalo's Blog</title>
  <meta name="author" content="Matteo Depalo">

  
  <meta name="description" content="Introduction This is a summary of my experiences and a mini-guide regarding the deploying and usage of a Cube server and Geckoboard to track &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://matteodepalo.github.io/blog/2012/07/23/cube-loves-geckoboard">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Matteo Depalo's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<!-- <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<link rel="stylesheet" type="text/css" href="//cloud.typography.com/7390232/803822/css/fonts.css" />
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-33611779-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Matteo Depalo's Blog</a></h1>
  
    <!-- <h2>Will driven life.</h2> -->
    <h2>Looking for <a href="http://matteodepalo.com">work</a></h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:matteodepalo.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Cube Loves Geckoboard</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-23T12:02:00+02:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Introduction</h2>

<p>This is a summary of my experiences and a mini-guide regarding the deploying and usage of a Cube server and Geckoboard to track statistics at Responsa.</p>

<p>I&rsquo;ll explain how I deployed Cube to a VPS in the cloud and how I&rsquo;ve integrated it in Responsa. I&rsquo;ll also talk about Geckoboard and how we used it to draw graphs based on metrics extracted from Cube, but first here&rsquo;s a brief description of Cube and Geckoboard.</p>

<h3>Cube</h3>

<p><a href="http://square.github.com/cube/">Cube</a> is a system for collecting timestamped events and deriving metrics. By collecting events rather than metrics, Cube lets you compute aggregate statistics post hoc. It also enables richer analysis, such as quantiles and histograms of arbitrary event sets.</p>

<h3>Geckoboard</h3>

<p><a href="http://www.geckoboard.com">Geckoboard</a> is a service for drawing graphs and statistics and organizing them in widgets that populate dashboards.</p>

<h2>Deploying</h2>

<p>To deploy the Cube server I&rsquo;ve chosen Linode, a service that gives you an empty Ubuntu Server virtual machine in the cloud. After the creation of the machine you can just ssh inside and start installing your server.</p>

<p>To make the deploying process automatic I&rsquo;ve chosen <a href="http://wiki.opscode.com/display/chef/About">chef</a>, and in particular <a href="http://wiki.opscode.com/display/chef/Chef+Solo">chef-solo</a>.</p>

<p>Since chef uses ruby we need to install it first in our machine so just run these commands to get some basic stuff:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apt-get -y update
</span><span class='line'>apt-get -y install curl git-core python-software-properties
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -L https://raw.github.com/fesplugas/rbenv-installer/master/bin/rbenv-installer | bash
</span><span class='line'>vim ~/.bashrc <span class="c"># add rbenv to the top</span>
</span><span class='line'>. ~/.bashrc
</span><span class='line'>rbenv bootstrap-ubuntu-10-04
</span><span class='line'>rbenv install 1.9.3-p125
</span><span class='line'>rbenv global 1.9.3-p125
</span><span class='line'>gem install bundler --no-ri --no-rdoc
</span><span class='line'>rbenv rehash
</span></code></pre></td></tr></table></div></figure>


<p>Then you can install Cube with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone git://github.com/matteodepalo/cube.git
</span><span class='line'><span class="nb">cd </span>cube
</span></code></pre></td></tr></table></div></figure>


<p>Now all you need to do is to download the cookbooks and run chef:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem install librarian
</span><span class='line'>librarian-chef install
</span><span class='line'>chef-solo -c solo.rb
</span></code></pre></td></tr></table></div></figure>


<p>And your Cube server should be up and running ready to track events!</p>

<h2>Tracking events</h2>

<p>We use Ruby on Rails as our stack so I&rsquo;ve chosen the <a href="https://github.com/codykrieger/cube-ruby">cube-ruby</a> gem to communicate with the server. With this gem you can talk with the <a href="https://github.com/square/cube/wiki/Collector">Cube collector</a> in order to track events.</p>

<p>For example if we want to track a request we can write:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vg">$cube</span> <span class="o">=</span> <span class="ss">Cube</span><span class="p">:</span><span class="ss">:Client</span><span class="o">.</span><span class="n">new</span> <span class="s1">&#39;your-host.com&#39;</span>
</span><span class='line'><span class="vg">$cube</span><span class="o">.</span><span class="n">send</span> <span class="s2">&quot;request&quot;</span><span class="p">,</span> <span class="ss">:value</span> <span class="o">=&gt;</span> <span class="s1">&#39;somevalue&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Analysis</h2>

<p>To compute metrics I&rsquo;ve created a ruby gem called <a href="https://github.com/matteodepalo/cube-evaluator">cube-evaluator</a>, which talks with the <a href="https://github.com/square/cube/wiki/Collector">Cube evaluator</a>.</p>

<p>Let&rsquo;s say we want the daily requests on our website in this month we can write:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vg">$cube_evaluator</span> <span class="o">=</span> <span class="ss">Cube</span><span class="p">:</span><span class="ss">:Evaluator</span><span class="o">.</span><span class="n">new</span> <span class="s1">&#39;your-host.com&#39;</span>
</span><span class='line'><span class="n">daily_requests</span> <span class="o">=</span> <span class="vg">$cube_evaluator</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span>
</span><span class='line'>                 <span class="ss">:expression</span> <span class="o">=&gt;</span> <span class="s1">&#39;sum(request)&#39;</span><span class="p">,</span>
</span><span class='line'>                 <span class="ss">:start</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">ago</span><span class="p">,</span>
</span><span class='line'>                 <span class="ss">:stop</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="p">,</span>
</span><span class='line'>                 <span class="ss">:step</span> <span class="o">=&gt;</span> <span class="s1">&#39;1day&#39;</span>
</span><span class='line'>               <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>daily_requests</code> will be an Hash containing the array of times and the array of corresponding values</p>

<h2>Drawing</h2>

<p>Geckoboard needs an endpoint in your server to poll in order to draw the data. To ease the creation of these endpoints I&rsquo;ve improved and used the <a href="https://github.com/matteodepalo/chameleon">chameleon gem</a>. Just add it to your gemfile</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;chameleon&#39;</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">&#39;git://github.com/matteodepalo/chameleon.git&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>then run bundle to install it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bundle install
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s draw the daily_requests now. Create a line widget graph</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails g chameleon:widget requests line
</span></code></pre></td></tr></table></div></figure>


<p>and use your daily_requests hash to populate it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Chameleon</span><span class="p">:</span><span class="ss">:Widget</span><span class="o">.</span><span class="n">new</span> <span class="ss">:requests</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">key</span> <span class="s2">&quot;3618c90ec02d5a57061ad7b78afcbb050e50b608&quot;</span>
</span><span class='line'>  <span class="n">type</span> <span class="s2">&quot;line&quot;</span>
</span><span class='line'>  <span class="n">data</span> <span class="k">do</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="ss">:items</span> <span class="o">=&gt;</span> <span class="n">daily_requests</span><span class="o">[</span><span class="ss">:values</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:x_axis</span> <span class="o">=&gt;</span> <span class="n">daily_requests</span><span class="o">[</span><span class="ss">:times</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:y_axis</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="n">daily_requests</span><span class="o">[</span><span class="ss">:times</span><span class="o">].</span><span class="n">min</span><span class="p">,</span> <span class="n">daily_requests</span><span class="o">[</span><span class="ss">:times</span><span class="o">].</span><span class="n">max</span><span class="o">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Congrats! You are now tracking statistics in the coolest way possible ;)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Matteo Depalo</span></span>

      








  


<time datetime="2012-07-23T12:02:00+02:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/chef/'>chef</a>, <a class='category' href='/blog/categories/cube/'>cube</a>, <a class='category' href='/blog/categories/geckoboard/'>geckoboard</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/statstics/'>statstics</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://matteodepalo.github.io/blog/2012/07/23/cube-loves-geckoboard/" data-via="matteodepalo" data-counturl="http://matteodepalo.github.io/blog/2012/07/23/cube-loves-geckoboard/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/2013/01/31/how-to-create-custom-stylesheets-dynamically-with-rails-and-sass/" title="Next Post: How to create custom stylesheets dynamically with Rails and Sass">How to create custom stylesheets dynamically with Rails and Sass &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/07/24/rails-api-documentation/">Rails API Documentation</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/08/minimum-viable-stack/">Minimum Viable Stack</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/07/how-i-migrated-from-heroku-to-digital-ocean-with-chef-and-capistrano/">How I Migrated From Heroku to Digital Ocean With Chef and Capistrano</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/01/refactor-replace-method-with-method-object/">Refactor: Replace Method With Method Object</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/31/how-to-create-custom-stylesheets-dynamically-with-rails-and-sass/">How to Create Custom Stylesheets Dynamically With Rails and Sass</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/matteodepalo">@matteodepalo</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'matteodepalo',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/102959180704550392673?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Matteo Depalo -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'matteodepalo';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://matteodepalo.github.io/blog/2012/07/23/cube-loves-geckoboard/';
        var disqus_url = 'http://matteodepalo.github.io/blog/2012/07/23/cube-loves-geckoboard/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
